/* PageLines Platform - 5.0.134
* Built: Wednesday, April 6th, 2016, 20:13
* http://www.pagelines.com
* Copyright (c) 2016 PageLines; Licensed GPL-3.0 */
!function(a,b){"use strict";function c(a,b,c){this.root=this.currentNode=a,this.nodeType=b,this.filter=c}function d(a,b){for(var c=a.length;c--;)if(!b(a[c]))return!1;return!0}function e(a,b,c){if(a.nodeName!==b)return!1;for(var d in c)if(a.getAttribute(d)!==c[d])return!1;return!0}function f(a,b){return!g(a)&&a.nodeType===b.nodeType&&a.nodeName===b.nodeName&&a.className===b.className&&(!a.style&&!b.style||a.style.cssText===b.style.cssText)}function g(a){return a.nodeType===F&&!!ea[a.nodeName]}function h(a){return da.test(a.nodeName)}function i(a){var b=a.nodeType;return(b===F||b===H)&&!h(a)&&d(a.childNodes,h)}function j(a){var b=a.nodeType;return!(b!==F&&b!==H||h(a)||i(a))}function k(a){var b=a.ownerDocument,d=new c(b.body,I,i,!1);return d.currentNode=a,d}function l(a){return k(a).previousNode()}function m(a){return k(a).nextNode()}function n(a,b,c){do if(e(a,b,c))return a;while(a=a.parentNode);return null}function o(a){var b,c,d,e,f,g=a.parentNode;return g&&a.nodeType===F?(b=o(g),b+=(b?">":"")+a.nodeName,(c=a.id)&&(b+="#"+c),(d=a.className.trim())&&(e=d.split(/\s\s*/),e.sort(),b+=".",b+=e.join(".")),(f=a.dir)&&(b+="[dir="+f+"]")):b=g?o(g):"",b}function p(a){var b=a.nodeType;return b===F?a.childNodes.length:a.length||0}function q(a){var b=a.parentNode;return b&&b.removeChild(a),a}function r(a,b){var c=a.parentNode;c&&c.replaceChild(b,a)}function s(a){for(var b=a.ownerDocument.createDocumentFragment(),c=a.childNodes,d=c?c.length:0;d--;)b.appendChild(a.firstChild);return b}function t(a,c,d,e){var f,g,h,i,j=a.createElement(c);if(d instanceof Array&&(e=d,d=null),d)for(f in d)g=d[f],g!==b&&j.setAttribute(f,d[f]);if(e)for(h=0,i=e.length;i>h;h+=1)j.appendChild(e[h]);return j}function u(a){var b,c,d=a.ownerDocument,e=a;if("BODY"===a.nodeName&&((c=a.firstChild)&&"BR"!==c.nodeName||(b=A(d).createDefaultBlock(),c?a.replaceChild(b,c):a.appendChild(b),a=b,b=null)),h(a)){for(c=a.firstChild;Z&&c&&c.nodeType===G&&!c.data;)a.removeChild(c),c=a.firstChild;c||(Z?(b=d.createTextNode(O),A(d)._didAddZWS()):b=d.createTextNode(""))}else if(Y){for(;a.nodeType!==G&&!g(a);){if(c=a.firstChild,!c){b=d.createTextNode("");break}a=c}a.nodeType===G?/^ +$/.test(a.data)&&(a.data=""):g(a)&&a.parentNode.insertBefore(d.createTextNode(""),a)}else if(!a.querySelector("BR"))for(b=t(d,"BR");(c=a.lastElementChild)&&!h(c);)a=c;return b&&a.appendChild(b),e}function v(a){var b,c,d,e,f=a.childNodes,g=a.ownerDocument,i=null,k=A(g)._config;for(b=0,c=f.length;c>b;b+=1)d=f[b],e="BR"===d.nodeName,!e&&h(d)?(i||(i=t(g,k.blockTag,k.blockAttributes)),i.appendChild(d),b-=1,c-=1):(e||i)&&(i||(i=t(g,k.blockTag,k.blockAttributes)),u(i),e?a.replaceChild(i,d):(a.insertBefore(i,d),b+=1,c+=1),i=null),j(d)&&v(d);return i&&a.appendChild(u(i)),a}function w(a,b,c){var d,e,f,g=a.nodeType;if(g===G&&a!==c)return w(a.parentNode,a.splitText(b),c);if(g===F){if("number"==typeof b&&(b=b<a.childNodes.length?a.childNodes[b]:null),a===c)return b;for(d=a.parentNode,e=a.cloneNode(!1);b;)f=b.nextSibling,e.appendChild(b),b=f;return"OL"===a.nodeName&&n(a,"BLOCKQUOTE")&&(e.start=(+a.start||1)+a.childNodes.length-1),u(a),u(e),(f=a.nextSibling)?d.insertBefore(e,f):d.appendChild(e),w(d,e,c)}return b}function x(a,b){if(a.nodeType===F)for(var c,d,e,g=a.childNodes,i=g.length,j=[];i--;)if(c=g[i],d=i&&g[i-1],i&&h(c)&&f(c,d)&&!ea[c.nodeName])b.startContainer===c&&(b.startContainer=d,b.startOffset+=p(d)),b.endContainer===c&&(b.endContainer=d,b.endOffset+=p(d)),b.startContainer===a&&(b.startOffset>i?b.startOffset-=1:b.startOffset===i&&(b.startContainer=d,b.startOffset=p(d))),b.endContainer===a&&(b.endOffset>i?b.endOffset-=1:b.endOffset===i&&(b.endContainer=d,b.endOffset=p(d))),q(c),c.nodeType===G?d.appendData(c.data):j.push(s(c));else if(c.nodeType===F){for(e=j.length;e--;)c.appendChild(j.pop());x(c,b)}}function y(a,b,c){for(var d,e,f,g=b;1===g.parentNode.childNodes.length;)g=g.parentNode;q(g),e=a.childNodes.length,d=a.lastChild,d&&"BR"===d.nodeName&&(a.removeChild(d),e-=1),f={startContainer:a,startOffset:e,endContainer:a,endOffset:e},a.appendChild(s(b)),x(a,f),c.setStart(f.startContainer,f.startOffset),c.collapse(!0),V&&(d=a.lastChild)&&"BR"===d.nodeName&&a.removeChild(d)}function z(a){var b,c,d=a.previousSibling,e=a.firstChild,g=a.ownerDocument,h="LI"===a.nodeName;if(!h||e&&/^[OU]L$/.test(e.nodeName))if(d&&f(d,a)){if(!j(d)){if(!h)return;c=t(g,"DIV"),c.appendChild(s(d)),d.appendChild(c)}q(a),b=!j(a),d.appendChild(s(a)),b&&v(d),e&&z(e)}else h&&(d=t(g,"DIV"),a.insertBefore(d,e),u(d))}function A(a){for(var b,c=Oa.length;c--;)if(b=Oa[c],b._doc===a)return b;return null}function B(a,b){var c,d;a||(a={});for(c in b)d=b[c],a[c]=d&&d.constructor===Object?B(a[c],d):d;return a}function C(a,b){var c,d=a.defaultView,e=a.body;this._win=d,this._doc=a,this._body=e,this._events={},this._lastSelection=null,$&&this.addEventListener("beforedeactivate",this.getSelection),this._hasZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this.addEventListener("keyup",this._updatePathOnEvent),this.addEventListener("mouseup",this._updatePathOnEvent),d.addEventListener("focus",this,!1),d.addEventListener("blur",this,!1),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,_?(c=new MutationObserver(this._docWasChanged.bind(this)),c.observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=c):this.addEventListener("keyup",this._keyUpDetectChange),this._awaitingPaste=!1,this.addEventListener(U?"beforecut":"cut",Ma),this.addEventListener(U?"beforepaste":"paste",Na),this.addEventListener(V?"keypress":"keydown",va),this._keyHandlers=Object.create(za),this.setConfig(b),U&&(d.Text.prototype.splitText=function(a){var b=this.ownerDocument.createTextNode(this.data.slice(a)),c=this.nextSibling,d=this.parentNode,e=this.length-a;return c?d.insertBefore(b,c):d.appendChild(b),e&&this.deleteData(a,e),b}),e.setAttribute("contenteditable","true");try{a.execCommand("enableObjectResizing",!1,"false"),a.execCommand("enableInlineTableEditing",!1,"false")}catch(f){}Oa.push(this),this.setHTML("")}function D(a,b,c){var d,e;for(d=b.firstChild;d;d=e){if(e=d.nextSibling,h(d)){if(d.nodeType===G||"BR"===d.nodeName||"IMG"===d.nodeName){c.appendChild(d);continue}}else if(i(d)){c.appendChild(a.createDefaultBlock([D(a,d,a._doc.createDocumentFragment())]));continue}D(a,d,c)}return c}var E=2,F=1,G=3,H=11,I=1,J=4,K=0,L=1,M=2,N=3,O="​",P=a.defaultView,Q=navigator.userAgent,R=/iP(?:ad|hone|od)/.test(Q),S=/Mac OS X/.test(Q),T=/Gecko\//.test(Q),U=/Trident\/[456]\./.test(Q),V=!!P.opera,W=/WebKit\//.test(Q),X=S?"meta-":"ctrl-",Y=U||V,Z=U||W,$=U,_="undefined"!=typeof MutationObserver,aa=/[^ \t\r\n]/,ba=Array.prototype.indexOf;Object.create||(Object.create=function(a){var b=function(){};return b.prototype=a,new b});var ca={1:1,2:2,3:4,8:128,9:256,11:1024};c.prototype.nextNode=function(){for(var a,b=this.currentNode,c=this.root,d=this.nodeType,e=this.filter;;){for(a=b.firstChild;!a&&b&&b!==c;)a=b.nextSibling,a||(b=b.parentNode);if(!a)return null;if(ca[a.nodeType]&d&&e(a))return this.currentNode=a,a;b=a}},c.prototype.previousNode=function(){for(var a,b=this.currentNode,c=this.root,d=this.nodeType,e=this.filter;;){if(b===c)return null;if(a=b.previousSibling)for(;b=a.lastChild;)a=b;else a=b.parentNode;if(!a)return null;if(ca[a.nodeType]&d&&e(a))return this.currentNode=a,a;b=a}},c.prototype.previousPONode=function(){for(var a,b=this.currentNode,c=this.root,d=this.nodeType,e=this.filter;;){for(a=b.lastChild;!a&&b&&b!==c;)a=b.previousSibling,a||(b=b.parentNode);if(!a)return null;if(ca[a.nodeType]&d&&e(a))return this.currentNode=a,a;b=a}};var da=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|U|VAR|WBR)$/,ea={BR:1,IMG:1,INPUT:1},fa=function(a,b){for(var c=a.childNodes;b&&a.nodeType===F;)a=c[b-1],c=a.childNodes,b=c.length;return a},ga=function(a,b){if(a.nodeType===F){var c=a.childNodes;if(b<c.length)a=c[b];else{for(;a&&!a.nextSibling;)a=a.parentNode;a&&(a=a.nextSibling)}}return a},ha=function(a,b){var c,d,e,f,g=a.startContainer,h=a.startOffset,i=a.endContainer,j=a.endOffset;g.nodeType===G?(c=g.parentNode,d=c.childNodes,h===g.length?(h=ba.call(d,g)+1,a.collapsed&&(i=c,j=h)):(h&&(f=g.splitText(h),i===g?(j-=h,i=f):i===c&&(j+=1),g=f),h=ba.call(d,g)),g=c):d=g.childNodes,e=d.length,h===e?g.appendChild(b):g.insertBefore(b,d[h]),g===i&&(j+=d.length-e),a.setStart(g,h),a.setEnd(i,j)},ia=function(a,b){var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset;b||(b=a.commonAncestorContainer),b.nodeType===G&&(b=b.parentNode);for(var g,h,i,j=w(e,f,b),k=w(c,d,b),l=b.ownerDocument.createDocumentFragment();k!==j;)g=k.nextSibling,l.appendChild(k),k=g;return c=b,d=j?ba.call(b.childNodes,j):b.childNodes.length,i=b.childNodes[d],h=i&&i.previousSibling,h&&h.nodeType===G&&i.nodeType===G&&(c=h,d=h.length,h.appendData(i.data),q(i)),a.setStart(c,d),a.collapse(!0),u(b),l},ja=function(a){na(a);var b=a.startContainer,c=a.endContainer,d=(h(b)||i(b))&&(h(c)||i(c));ia(a),ma(a),d&&(b=oa(a),c=pa(a),b&&c&&b!==c&&y(b,c,a)),b&&u(b);var e=a.endContainer.ownerDocument.body,f=e.firstChild;f&&"BR"!==f.nodeName?a.collapse(!1):(u(e),a.selectNodeContents(e.firstChild))},ka=function(a,b){for(var c=!0,d=b.childNodes,e=d.length;e--;)if(!h(d[e])){c=!1;break}if(a.collapsed||ja(a),ma(a),c)ha(a,b),a.collapse(!1);else{for(var f,g,k,o,p,q=a.startContainer,r=w(q,a.startOffset,n(q.parentNode,"BLOCKQUOTE")||q.ownerDocument.body),s=r.previousSibling,t=s,v=t.childNodes.length,x=r,y=0,A=r.parentNode;(f=t.lastChild)&&f.nodeType===F;){if("BR"===f.nodeName){v-=1;break}t=f,v=t.childNodes.length}for(;(f=x.firstChild)&&f.nodeType===F&&"BR"!==f.nodeName;)x=f;for(p=t.childNodes[v]||null;(f=b.firstChild)&&h(f);)t.insertBefore(f,p);for(;(f=b.lastChild)&&h(f);)x.insertBefore(f,x.firstChild),y+=1;for(g=b;g=m(g);)u(g);if(A.insertBefore(b,r),o=s.nextSibling,g=l(o),!/\S/.test(g.textContent))do A=g.parentNode,A.removeChild(g),g=A;while(A&&!A.lastChild&&"BODY"!==A.nodeName);if(s.parentNode||(s=o.previousSibling),t.parentNode||(t=s||o.parentNode,v=s?s.childNodes.length:0),j(o)&&z(o),k=r.previousSibling,g=i(r)?r:m(r),!/\S/.test(g.textContent))do A=g.parentNode,A.removeChild(g),g=A;while(A&&!A.lastChild&&"BODY"!==A.nodeName);r.parentNode||(r=k.nextSibling),y||(x=k,y=k.childNodes.length),r&&j(r)&&z(r),a.setStart(t,v),a.setEnd(x,y),ma(a)}},la=function(a,b,c){var d=b.ownerDocument.createRange();if(d.selectNode(b),c){var e=a.compareBoundaryPoints(N,d)>-1,f=a.compareBoundaryPoints(L,d)<1;return!e&&!f}var g=a.compareBoundaryPoints(K,d)<1,h=a.compareBoundaryPoints(M,d)>-1;return g&&h},ma=function(a){for(var b,c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset;c.nodeType!==G&&(b=c.childNodes[d],b&&!g(b));)c=b,d=0;if(f)for(;e.nodeType!==G&&(b=e.childNodes[f-1],b&&!g(b));)e=b,f=p(e);else for(;e.nodeType!==G&&(b=e.firstChild,b&&!g(b));)e=b;a.collapsed?(a.setStart(e,f),a.setEnd(c,d)):(a.setStart(c,d),a.setEnd(e,f))},na=function(a,b){var c,d=a.startContainer,e=a.startOffset,f=a.endContainer,g=a.endOffset;for(b||(b=a.commonAncestorContainer);d!==b&&!e;)c=d.parentNode,e=ba.call(c.childNodes,d),d=c;for(;f!==b&&g===p(f);)c=f.parentNode,g=ba.call(c.childNodes,f)+1,f=c;a.setStart(d,e),a.setEnd(f,g)},oa=function(a){var b,c=a.startContainer;return h(c)?b=l(c):i(c)?b=c:(b=fa(c,a.startOffset),b=m(b)),b&&la(a,b,!0)?b:null},pa=function(a){var b,c,d=a.endContainer;if(h(d))b=l(d);else if(i(d))b=d;else{if(b=ga(d,a.endOffset),!b)for(b=d.ownerDocument.body;c=b.lastChild;)b=c;b=l(b)}return b&&la(a,b,!0)?b:null},qa=new c(null,J|I,function(a){return a.nodeType===G?aa.test(a.data):"IMG"===a.nodeName}),ra=function(a){var b=a.startContainer,c=a.startOffset;if(qa.root=null,b.nodeType===G){if(c)return!1;qa.currentNode=b}else qa.currentNode=ga(b,c);return qa.root=oa(a),!qa.previousNode()},sa=function(a){var b,c=a.endContainer,d=a.endOffset;if(qa.root=null,c.nodeType===G){if(b=c.data.length,b&&b>d)return!1;qa.currentNode=c}else qa.currentNode=fa(c,d);return qa.root=pa(a),!qa.nextNode()},ta=function(a){var b,c=oa(a),d=pa(a);c&&d&&(b=c.parentNode,a.setStart(b,ba.call(b.childNodes,c)),b=d.parentNode,a.setEnd(b,ba.call(b.childNodes,d)+1))},ua={8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",37:"left",39:"right",46:"delete",219:"[",221:"]"},va=function(a){var b=a.keyCode,c=ua[b],d="",e=this.getSelection();a.defaultPrevented||(c||(c=String.fromCharCode(b).toLowerCase(),/^[A-Za-z0-9]$/.test(c)||(c="")),V&&46===a.which&&(c="."),b>111&&124>b&&(c="f"+(b-111)),"backspace"!==c&&"delete"!==c&&(a.altKey&&(d+="alt-"),a.ctrlKey&&(d+="ctrl-"),a.metaKey&&(d+="meta-")),a.shiftKey&&(d+="shift-"),c=d+c,this._keyHandlers[c]?this._keyHandlers[c](this,a,e):1!==c.length||e.collapsed||(this._recordUndoState(e),this._getRangeAndRemoveBookmark(e),ja(e),this._ensureBottomLine(),this.setSelection(e),this._updatePath(e,!0)))},wa=function(a){return function(b,c){c.preventDefault(),b[a]()}},xa=function(a,b){return b=b||null,function(c,d){d.preventDefault();var e=c.getSelection();c.hasFormat(a,null,e)?c.changeFormat(null,{tag:a},e):c.changeFormat({tag:a},b,e)}},ya=function(a,b){try{b||(b=a.getSelection());var c,d=b.startContainer;for(d.nodeType===G&&(d=d.parentNode),c=d;h(c)&&(!c.textContent||c.textContent===O);)d=c,c=d.parentNode;d!==c&&(b.setStart(c,ba.call(c.childNodes,d)),b.collapse(!0),c.removeChild(d),i(c)||(c=l(c)),u(c),ma(b)),"BODY"===d.nodeName&&(d=d.firstChild)&&"BR"===d.nodeName&&q(d),a._ensureBottomLine(),a.setSelection(b),a._updatePath(b,!0)}catch(e){a.didError(e)}},za={enter:function(a,b,c){var d,e,f;if(b.preventDefault(),a._recordUndoState(c),eb(c.startContainer),a._removeZWS(),a._getRangeAndRemoveBookmark(c),c.collapsed||ja(c),d=oa(c),!d||/^T[HD]$/.test(d.nodeName))return ha(c,a.createElement("BR")),c.collapse(!1),a.setSelection(c),void a._updatePath(c,!0);if((e=n(d,"LI"))&&(d=e),!d.textContent){if(n(d,"UL")||n(d,"OL"))return a.modifyBlocks(cb,c);if(n(d,"BLOCKQUOTE"))return a.modifyBlocks(Ya,c)}for(f=Va(a,d,c.startContainer,c.startOffset),Ra(d),Ia(d),u(d);f.nodeType===F;){var g,h=f.firstChild;if("A"===f.nodeName&&(!f.textContent||f.textContent===O)){h=a._doc.createTextNode(""),r(f,h),f=h;break}for(;h&&h.nodeType===G&&!h.data&&(g=h.nextSibling,g&&"BR"!==g.nodeName);)q(h),h=g;if(!h||"BR"===h.nodeName||h.nodeType===G&&!V)break;f=h}c=a._createRange(f,0),a.setSelection(c),a._updatePath(c,!0),f.nodeType===G&&(f=f.parentNode);var i=a._doc,j=a._body;f.offsetTop+f.offsetHeight>(i.documentElement.scrollTop||j.scrollTop)+j.offsetHeight&&f.scrollIntoView(!1)},backspace:function(a,b,c){if(a._removeZWS(),a._recordUndoState(c),a._getRangeAndRemoveBookmark(c),c.collapsed)if(ra(c)){b.preventDefault();var d=oa(c),e=d&&l(d);if(e){if(!e.isContentEditable)return void q(e);for(y(e,d,c),d=e.parentNode;d&&!d.nextSibling;)d=d.parentNode;d&&(d=d.nextSibling)&&z(d),a.setSelection(c)}else if(d){if(n(d,"UL")||n(d,"OL"))return a.modifyBlocks(cb,c);if(n(d,"BLOCKQUOTE"))return a.modifyBlocks(Xa,c);a.setSelection(c),a._updatePath(c,!0)}}else a.setSelection(c),setTimeout(function(){ya(a)},0);else b.preventDefault(),ja(c),ya(a,c)},"delete":function(a,b,c){if(a._removeZWS(),a._recordUndoState(c),a._getRangeAndRemoveBookmark(c),c.collapsed)if(sa(c)){b.preventDefault();var d=oa(c),e=d&&m(d);if(e){if(!e.isContentEditable)return void q(e);for(y(d,e,c),e=d.parentNode;e&&!e.nextSibling;)e=e.parentNode;e&&(e=e.nextSibling)&&z(e),a.setSelection(c),a._updatePath(c,!0)}}else{var f,g,h,i=c.cloneRange();if(na(c,a._body),f=c.endContainer,g=c.endOffset,f.nodeType===F&&(h=f.childNodes[g],h&&"IMG"===h.nodeName))return b.preventDefault(),q(h),ma(c),void ya(a,c);a.setSelection(i),setTimeout(function(){ya(a)},0)}else b.preventDefault(),ja(c),ya(a,c)},tab:function(a,b,c){var d,e;if(a._removeZWS(),c.collapsed&&ra(c)&&sa(c))for(d=oa(c);e=d.parentNode;){if("UL"===e.nodeName||"OL"===e.nodeName){d.previousSibling&&(b.preventDefault(),a.modifyBlocks(bb,c));break}d=e}},space:function(a,b,c){var d,e;a._recordUndoState(c),eb(c.startContainer),a._getRangeAndRemoveBookmark(c),d=c.endContainer,e=d.parentNode,c.collapsed&&"A"===e.nodeName&&!d.nextSibling&&c.endOffset===p(d)&&c.setStartAfter(e),a.setSelection(c)},left:function(a){a._removeZWS()},right:function(a){a._removeZWS()}};S&&T&&P.getSelection().modify&&(za["meta-left"]=function(a,b){b.preventDefault(),a._sel.modify("move","backward","lineboundary")},za["meta-right"]=function(a,b){b.preventDefault(),a._sel.modify("move","forward","lineboundary")}),S||(za.pageup=function(a){a.moveCursorToStart()},za.pagedown=function(a){a.moveCursorToEnd()}),za[X+"b"]=xa("B"),za[X+"i"]=xa("I"),za[X+"u"]=xa("U"),za[X+"shift-7"]=xa("S"),za[X+"shift-5"]=xa("SUB",{tag:"SUP"}),za[X+"shift-6"]=xa("SUP",{tag:"SUB"}),za[X+"shift-8"]=wa("makeUnorderedList"),za[X+"shift-9"]=wa("makeOrderedList"),za[X+"["]=wa("decreaseQuoteLevel"),za[X+"]"]=wa("increaseQuoteLevel"),za[X+"y"]=wa("redo"),za[X+"z"]=wa("undo"),za[X+"shift-z"]=wa("redo");var Aa={1:10,2:13,3:16,4:18,5:24,6:32,7:48},Ba={backgroundColor:{regexp:aa,replace:function(a,b){return t(a,"SPAN",{"class":"highlight",style:"background-color: "+b})}},color:{regexp:aa,replace:function(a,b){return t(a,"SPAN",{"class":"colour",style:"color:"+b})}},fontWeight:{regexp:/^bold/i,replace:function(a){return t(a,"B")}},fontStyle:{regexp:/^italic/i,replace:function(a){return t(a,"I")}},fontFamily:{regexp:aa,replace:function(a,b){return t(a,"SPAN",{"class":"font",style:"font-family:"+b})}},fontSize:{regexp:aa,replace:function(a,b){return t(a,"SPAN",{"class":"size",style:"font-size:"+b})}}},Ca=function(a){return function(b,c){var d=t(b.ownerDocument,a);return c.replaceChild(d,b),d.appendChild(s(b)),d}},Da={SPAN:function(a,b){var c,d,e,f,g,h,i=a.style,j=a.ownerDocument;for(c in Ba)d=Ba[c],e=i[c],e&&d.regexp.test(e)&&(h=d.replace(j,e),f&&f.appendChild(h),f=h,g||(g=h));return g&&(f.appendChild(s(a)),b.replaceChild(g,a)),f||a},STRONG:Ca("B"),EM:Ca("I"),STRIKE:Ca("S"),FONT:function(a,b){var c,d,e,f,g,h=a.face,i=a.size,j=a.color,k=a.ownerDocument;return h&&(c=t(k,"SPAN",{"class":"font",style:"font-family:"+h}),g=c,f=c),i&&(d=t(k,"SPAN",{"class":"size",style:"font-size:"+Aa[i]+"px"}),g||(g=d),f&&f.appendChild(d),f=d),j&&/^#?([\dA-F]{3}){1,2}$/i.test(j)&&("#"!==j.charAt(0)&&(j="#"+j),e=t(k,"SPAN",{"class":"colour",style:"color:"+j}),g||(g=e),f&&f.appendChild(e),f=e),g||(g=f=t(k,"SPAN")),b.replaceChild(g,a),f.appendChild(s(a)),f},TT:function(a,b){var c=t(a.ownerDocument,"SPAN",{"class":"font",style:'font-family:menlo,consolas,"courier new",monospace'});return b.replaceChild(c,a),c.appendChild(s(a)),c}},Ea=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|UL)$/,Fa=/^(?:HEAD|META|STYLE)/,Ga=new c(null,J|I,function(){return!0}),Ha=function gb(a){var b,c,d,e,f,g,i,j,k,l,m,n,o=a.childNodes;for(b=a;h(b);)b=b.parentNode;for(Ga.root=b,c=0,d=o.length;d>c;c+=1)if(e=o[c],f=e.nodeName,g=e.nodeType,i=Da[f],g===F){if(j=e.childNodes.length,i)e=i(e,a);else{if(Fa.test(f)){a.removeChild(e),c-=1,d-=1;continue}if(!Ea.test(f)&&!h(e)){c-=1,d+=j-1,a.replaceChild(s(e),e);continue}}j&&gb(e)}else{if(g===G){if(m=e.data,k=!aa.test(m.charAt(0)),l=!aa.test(m.charAt(m.length-1)),!k&&!l)continue;if(k){for(Ga.currentNode=e;(n=Ga.previousPONode())&&(f=n.nodeName,!("IMG"===f||"#text"===f&&/\S/.test(n.data)));)if(!h(n)){n=null;break}n||(m=m.replace(/^\s+/g,""))}if(l){for(Ga.currentNode=e;(n=Ga.nextNode())&&!("IMG"===f||"#text"===f&&/\S/.test(n.data));)if(!h(n)){n=null;break}n||(m=m.replace(/^\s+/g,""))}if(m){e.data=m;continue}}a.removeChild(e),c-=1,d-=1}return a},Ia=function hb(a){for(var b,c=a.childNodes,d=c.length;d--;)b=c[d],b.nodeType!==F||g(b)?b.nodeType!==G||b.data||a.removeChild(b):(hb(b),h(b)&&!b.firstChild&&a.removeChild(b))},Ja=function(a){return a.nodeType===F?"BR"===a.nodeName:aa.test(a.data)},Ka=function(a){for(var b,d=a.parentNode;h(d);)d=d.parentNode;return b=new c(d,I|J,Ja),b.currentNode=a,!!b.nextNode()},La=function(a){var b,c,d,e=a.querySelectorAll("BR"),f=[],g=e.length;for(b=0;g>b;b+=1)f[b]=Ka(e[b]);for(;g--;)c=e[g],d=c.parentNode,d&&(f[g]?h(d)||v(d):q(c))},Ma=function(){var a=this.getSelection(),b=this;this._recordUndoState(a),this._getRangeAndRemoveBookmark(a),this.setSelection(a),setTimeout(function(){try{b._ensureBottomLine()}catch(a){b.didError(a)}},0)},Na=function(a){var b,c,d,e,f=a.clipboardData,g=f&&f.items,h=!1,i=!1,j=null,k=this;if(g){for(a.preventDefault(),b=g.length;b--;){if(c=g[b],d=c.type,"text/html"===d)return void c.getAsString(function(a){k.insertHTML(a,!0)});"text/plain"===d&&(j=c),/^image\/.*/.test(d)&&(i=!0)}return void(i?(this.fireEvent("dragover",{dataTransfer:f,preventDefault:function(){h=!0}}),h&&this.fireEvent("drop",{dataTransfer:f})):j&&c.getAsString(function(a){k.insertPlainText(a,!0)}))}if(f&&(ba.call(f.types,"text/html")>-1||ba.call(f.types,"text/plain")>-1&&ba.call(f.types,"text/rtf")<0))return a.preventDefault(),void((e=f.getData("text/html"))?this.insertHTML(e,!0):(e=f.getData("text/plain"))&&this.insertPlainText(e,!0));this._awaitingPaste=!0;var l=this._body,m=this.getSelection(),n=m.startContainer,o=m.startOffset,p=m.endContainer,r=m.endOffset,s=oa(m),t=this.createElement("DIV",{style:"position: absolute; overflow: hidden; top:"+(l.scrollTop+(s?s.getBoundingClientRect().top:0))+"px; right: 150%; width: 1px; height: 1px;"});l.appendChild(t),m.selectNodeContents(t),this.setSelection(m),setTimeout(function(){try{k._awaitingPaste=!1;for(var a,b,c="",d=t;t=d;)d=t.nextSibling,q(t),a=t.firstChild,a&&a===t.lastChild&&"DIV"===a.nodeName&&(t=a),c+=t.innerHTML;b=k._createRange(n,o,p,r),k.setSelection(b),c&&k.insertHTML(c,!0)}catch(e){k.didError(e)}},0)},Oa=[],Pa=C.prototype;Pa.setConfig=function(a){return a=B({blockTag:"DIV",blockAttributes:null,tagAttributes:{blockquote:null,ul:null,ol:null,li:null}},a),a.blockTag=a.blockTag.toUpperCase(),this._config=a,this},Pa.createElement=function(a,b,c){return t(this._doc,a,b,c)},Pa.createDefaultBlock=function(a){var b=this._config;return u(this.createElement(b.blockTag,b.blockAttributes,a))},Pa.didError=function(a){console.log(a)},Pa.getDocument=function(){return this._doc};var Qa={focus:1,blur:1,pathChange:1,select:1,input:1,undoStateChange:1};Pa.fireEvent=function(a,b){var c,d,e=this._events[a];if(e)for(b||(b={}),b.type!==a&&(b.type=a),e=e.slice(),c=e.length;c--;){d=e[c];try{d.handleEvent?d.handleEvent(b):d.call(this,b)}catch(f){f.details="Squire: fireEvent error. Event type: "+a,this.didError(f)}}return this},Pa.destroy=function(){var a,b=this._win,c=this._doc,d=this._events;b.removeEventListener("focus",this,!1),b.removeEventListener("blur",this,!1);for(a in d)Qa[a]||c.removeEventListener(a,this,!0);this._mutation&&this._mutation.disconnect();for(var e=Oa.length;e--;)Oa[e]===this&&Oa.splice(e,1)},Pa.handleEvent=function(a){this.fireEvent(a.type,a)},Pa.addEventListener=function(a,b){var c=this._events[a];return b?(c||(c=this._events[a]=[],Qa[a]||this._doc.addEventListener(a,this,!0)),c.push(b),this):(this.didError({name:"Squire: addEventListener with null or undefined fn",message:"Event type: "+a}),this)},Pa.removeEventListener=function(a,b){var c,d=this._events[a];if(d){for(c=d.length;c--;)d[c]===b&&d.splice(c,1);d.length||(delete this._events[a],Qa[a]||this._doc.removeEventListener(a,this,!1))}return this},Pa._createRange=function(a,b,c,d){if(a instanceof this._win.Range)return a.cloneRange();var e=this._doc.createRange();return e.setStart(a,b),c?e.setEnd(c,d):e.setEnd(a,b),e},Pa._moveCursorTo=function(a){var b=this._body,c=this._createRange(b,a?0:b.childNodes.length);return ma(c),this.setSelection(c),this},Pa.moveCursorToStart=function(){return this._moveCursorTo(!0)},Pa.moveCursorToEnd=function(){return this._moveCursorTo(!1)},Pa.setSelection=function(a){if(a){R&&this._win.focus();var b=this._getWindowSelection();b&&(b.removeAllRanges(),b.addRange(a))}return this},Pa._getWindowSelection=function(){return this._win.getSelection()||null},Pa.getSelection=function(){var a,b,c,d=this._getWindowSelection();return d&&d.rangeCount?(a=d.getRangeAt(0).cloneRange(),b=a.startContainer,c=a.endContainer,b&&g(b)&&a.setStartBefore(b),c&&g(c)&&a.setEndBefore(c),this._lastSelection=a):a=this._lastSelection,a||(a=this._createRange(this._body.firstChild,0)),a},Pa.getSelectedText=function(){var a,b=this.getSelection(),d=new c(b.commonAncestorContainer,J|I,function(a){return la(b,a,!0)}),e=b.startContainer,f=b.endContainer,g=d.currentNode=e,i="",j=!1;for(d.filter(g)||(g=d.nextNode());g;)g.nodeType===G?(a=g.data,a&&/\S/.test(a)&&(g===f&&(a=a.slice(0,b.endOffset)),g===e&&(a=a.slice(b.startOffset)),i+=a,j=!0)):("BR"===g.nodeName||j&&!h(g))&&(i+="\n",j=!1),g=d.nextNode();return i},Pa.getPath=function(){return this._path};var Ra=function(a){for(var b,d,e,f=new c(a,J,function(){return!0},!1);d=f.nextNode();)for(;(e=d.data.indexOf(O))>-1;){if(1===d.length){do b=d.parentNode,b.removeChild(d),d=b;while(h(d)&&!p(d));break}d.deleteData(e,1)}};Pa._didAddZWS=function(){this._hasZWS=!0},Pa._removeZWS=function(){this._hasZWS&&(Ra(this._body),this._hasZWS=!1)},Pa._updatePath=function(a,b){var c,d=a.startContainer,e=a.endContainer;(b||d!==this._lastAnchorNode||e!==this._lastFocusNode)&&(this._lastAnchorNode=d,this._lastFocusNode=e,c=d&&e?d===e?o(e):"(selection)":"",this._path!==c&&(this._path=c,this.fireEvent("pathChange",{path:c}))),a.collapsed||this.fireEvent("select")},Pa._updatePathOnEvent=function(){this._updatePath(this.getSelection())},Pa.focus=function(){return V||this._body.focus(),this._win.focus(),this},Pa.blur=function(){return T&&this._body.blur(),top.focus(),this};var Sa="squire-selection-start",Ta="squire-selection-end";Pa._saveRangeToBookmark=function(a){var b,c=this.createElement("INPUT",{id:Sa,type:"hidden"}),d=this.createElement("INPUT",{id:Ta,type:"hidden"});ha(a,c),a.collapse(!1),ha(a,d),c.compareDocumentPosition(d)&E&&(c.id=Ta,d.id=Sa,b=c,c=d,d=b),a.setStartAfter(c),a.setEndBefore(d)},Pa._getRangeAndRemoveBookmark=function(a){var b=this._doc,c=b.getElementById(Sa),d=b.getElementById(Ta);if(c&&d){var e,f=c.parentNode,g=d.parentNode,h={startContainer:f,endContainer:g,startOffset:ba.call(f.childNodes,c),endOffset:ba.call(g.childNodes,d)};f===g&&(h.endOffset-=1),q(c),q(d),x(f,h),f!==g&&x(g,h),a||(a=b.createRange()),a.setStart(h.startContainer,h.startOffset),a.setEnd(h.endContainer,h.endOffset),e=a.collapsed,ma(a),e&&a.collapse(!0)}return a||null},Pa._keyUpDetectChange=function(a){var b=a.keyCode;a.ctrlKey||a.metaKey||a.altKey||!(16>b||b>20)||!(33>b||b>45)||this._docWasChanged()},Pa._docWasChanged=function(){return _&&this._ignoreChange?void(this._ignoreChange=!1):(this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),void this.fireEvent("input"))},Pa._recordUndoState=function(a){if(!this._isInUndoState){var b=this._undoIndex+=1,c=this._undoStack;b<this._undoStackLength&&(c.length=this._undoStackLength=b),a&&this._saveRangeToBookmark(a),c[b]=this._getHTML(),this._undoStackLength+=1,this._isInUndoState=!0}},Pa.undo=function(){if(0!==this._undoIndex||!this._isInUndoState){this._recordUndoState(this.getSelection()),this._undoIndex-=1,this._setHTML(this._undoStack[this._undoIndex]);var a=this._getRangeAndRemoveBookmark();a&&this.setSelection(a),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")}return this},Pa.redo=function(){var a=this._undoIndex,b=this._undoStackLength;if(b>a+1&&this._isInUndoState){this._undoIndex+=1,this._setHTML(this._undoStack[this._undoIndex]);var c=this._getRangeAndRemoveBookmark();c&&this.setSelection(c),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:b>a+2}),this.fireEvent("input")}return this},Pa.hasFormat=function(a,b,d){if(a=a.toUpperCase(),b||(b={}),!d&&!(d=this.getSelection()))return!1;!d.collapsed&&d.startContainer.nodeType===G&&d.startOffset===d.startContainer.length&&d.startContainer.nextSibling&&d.setStartBefore(d.startContainer.nextSibling),!d.collapsed&&d.endContainer.nodeType===G&&0===d.endOffset&&d.endContainer.previousSibling&&d.setEndAfter(d.endContainer.previousSibling);var e,f,g=d.commonAncestorContainer;if(n(g,a,b))return!0;if(g.nodeType===G)return!1;e=new c(g,J,function(a){return la(d,a,!0)},!1);for(var h=!1;f=e.nextNode();){if(!n(f,a,b))return!1;h=!0}return h},Pa.getFontInfo=function(a){var c,d,e={family:b,size:b};if(!a&&!(a=this.getSelection()))return e;if(c=a.commonAncestorContainer,a.collapsed||c.nodeType===G)for(c.nodeType===G&&(c=c.parentNode);(!e.family||!e.size)&&c&&(d=c.style);)e.family||(e.family=d.fontFamily),e.size||(e.size=d.fontSize),c=c.parentNode;return e},Pa._addFormat=function(a,b,d){var e,f,g,h,i,j,k,l;if(d.collapsed)e=u(this.createElement(a,b)),ha(d,e),d.setStart(e.firstChild,e.firstChild.length),d.collapse(!0);else{if(f=new c(d.commonAncestorContainer,J|I,function(a){return(a.nodeType===G||"BR"===a.nodeName||"IMG"===a.nodeName)&&la(d,a,!0)},!1),g=d.startContainer,i=d.startOffset,h=d.endContainer,j=d.endOffset,f.currentNode=g,f.filter(g)||(g=f.nextNode(),i=0),!g)return d;do k=f.currentNode,l=!n(k,a,b),l&&(k===h&&k.length>j&&k.splitText(j),k===g&&i&&(k=k.splitText(i),h===g&&(h=k,j-=i),g=k,i=0),e=this.createElement(a,b),r(k,e),e.appendChild(k));while(f.nextNode());h.nodeType!==G&&(k.nodeType===G?(h=k,j=k.length):(h=k.parentNode,j=1)),d=this._createRange(g,i,h,j)}return d},Pa._removeFormat=function(a,b,c,d){this._saveRangeToBookmark(c);var f,g=this._doc;c.collapsed&&(Z?(f=g.createTextNode(O),this._didAddZWS()):f=g.createTextNode(""),ha(c,f));for(var i=c.commonAncestorContainer;h(i);)i=i.parentNode;var j=c.startContainer,k=c.startOffset,l=c.endContainer,m=c.endOffset,n=[],o=function(a,b){if(!la(c,a,!1)){var d,e,f=a.nodeType===G;if(!la(c,a,!0))return void("INPUT"===a.nodeName||f&&!a.data||n.push([b,a]));if(f)a===l&&m!==a.length&&n.push([b,a.splitText(m)]),a===j&&k&&(a.splitText(k),n.push([b,a]));else for(d=a.firstChild;d;d=e)e=d.nextSibling,o(d,b)}},p=Array.prototype.filter.call(i.getElementsByTagName(a),function(d){return la(c,d,!0)&&e(d,a,b)});d||p.forEach(function(a){o(a,a)}),n.forEach(function(a){var b=a[0].cloneNode(!1),c=a[1];r(c,b),b.appendChild(c)}),p.forEach(function(a){r(a,s(a))}),this._getRangeAndRemoveBookmark(c),f&&c.collapse(!1);var q={startContainer:c.startContainer,startOffset:c.startOffset,endContainer:c.endContainer,endOffset:c.endOffset};return x(i,q),c.setStart(q.startContainer,q.startOffset),c.setEnd(q.endContainer,q.endOffset),c},Pa.changeFormat=function(a,b,c,d){return c||(c=this.getSelection())?(this._recordUndoState(c),this._getRangeAndRemoveBookmark(c),b&&(c=this._removeFormat(b.tag.toUpperCase(),b.attributes||{},c,d)),a&&(c=this._addFormat(a.tag.toUpperCase(),a.attributes||{},c)),this.setSelection(c),this._updatePath(c,!0),_||this._docWasChanged(),this):void 0};var Ua={DT:"DD",DD:"DT",LI:"LI"},Va=function(a,b,c,d){var f=Ua[b.nodeName],g=null,h=w(c,d,b.parentNode),i=a._config;return f||(f=i.blockTag,g=i.blockAttributes),e(h,f,g)||(b=t(h.ownerDocument,f,g),h.dir&&(b.dir=h.dir),r(h,b),b.appendChild(s(h)),h=b),h};Pa.forEachBlock=function(a,b,c){if(!c&&!(c=this.getSelection()))return this;b&&(this._recordUndoState(c),this._getRangeAndRemoveBookmark(c));var d=oa(c),e=pa(c);if(d&&e)do if(a(d)||d===e)break;while(d=m(d));return b&&(this.setSelection(c),this._updatePath(c,!0),_||this._docWasChanged()),this},Pa.modifyBlocks=function(a,b){if(!b&&!(b=this.getSelection()))return this;this._isInUndoState?this._saveRangeToBookmark(b):this._recordUndoState(b),ta(b);var c,d=this._body;return na(b,d),c=ia(b,d),ha(b,a.call(this,c)),b.endOffset<b.endContainer.childNodes.length&&z(b.endContainer.childNodes[b.endOffset]),z(b.startContainer.childNodes[b.startOffset]),this._getRangeAndRemoveBookmark(b),this.setSelection(b),this._updatePath(b,!0),_||this._docWasChanged(),this};var Wa=function(a){return this.createElement("BLOCKQUOTE",this._config.tagAttributes.blockquote,[a])},Xa=function(a){var b=a.querySelectorAll("blockquote");
return Array.prototype.filter.call(b,function(a){return!n(a.parentNode,"BLOCKQUOTE")}).forEach(function(a){r(a,s(a))}),a},Ya=function(){return this.createDefaultBlock([this.createElement("INPUT",{id:Sa,type:"hidden"}),this.createElement("INPUT",{id:Ta,type:"hidden"})])},Za=function(a,b,c){for(var d,e,f,g,h=k(b),i=a._config.tagAttributes,j=i[c.toLowerCase()],l=i.li;d=h.nextNode();)e=d.parentNode.nodeName,"LI"!==e?(g=a.createElement("LI",l),d.dir&&(g.dir=d.dir),(f=d.previousSibling)&&f.nodeName===c?f.appendChild(g):r(d,a.createElement(c,j,[g])),g.appendChild(d)):(d=d.parentNode.parentNode,e=d.nodeName,e!==c&&/^[OU]L$/.test(e)&&r(d,a.createElement(c,j,[s(d)])))},$a=function(a){return Za(this,a,"UL"),a},_a=function(a){return Za(this,a,"OL"),a},ab=function(a){var b,c,d,e,f,g,h,i=a.querySelectorAll("UL, OL");for(b=0,c=i.length;c>b;b+=1){for(e=i[b],f=s(e),g=f.childNodes,d=g.length;d--;)h=g[d],r(h,s(h));v(f),r(e,f)}return a},bb=function(a){var b,c,d,e,f,g,h=a.querySelectorAll("LI"),i=this._config.tagAttributes,k=i.li;for(b=0,c=h.length;c>b;b+=1)d=h[b],j(d.firstChild)||(e=d.parentNode.nodeName,f=d.previousSibling,f&&(f=f.lastChild)&&f.nodeName===e||(g=i[e.toLowerCase()],r(d,this.createElement("LI",k,[f=this.createElement(e,g)]))),f.appendChild(d));return a},cb=function(a){var b=a.querySelectorAll("LI");return Array.prototype.filter.call(b,function(a){return!j(a.firstChild)}).forEach(function(b){var c,d=b.parentNode,e=d.parentNode,f=b.firstChild,g=f;for(b.previousSibling&&(d=w(d,b,e));g&&(c=g.nextSibling,!j(g));)e.insertBefore(g,d),g=c;for("LI"===e.nodeName&&f.previousSibling&&w(e,f,e.parentNode);b!==a&&!b.childNodes.length;)d=b.parentNode,d.removeChild(b),b=d},this),v(a),a};Pa._ensureBottomLine=function(){var a=this._body,b=a.lastElementChild;b&&b.nodeName===this._config.blockTag&&i(b)||a.appendChild(this.createDefaultBlock())},Pa.setKeyHandler=function(a,b){return this._keyHandlers[a]=b,this},Pa._getHTML=function(){return this._body.innerHTML},Pa._setHTML=function(a){var b=this._body;b.innerHTML=a;do u(b);while(b=m(b));this._ignoreChange=!0},Pa.getHTML=function(a){var b,c,d,e,f,g=[];if(a&&(f=this.getSelection())&&this._saveRangeToBookmark(f),Y)for(b=this._body;b=m(b);)b.textContent||b.querySelector("BR")||(c=this.createElement("BR"),b.appendChild(c),g.push(c));if(d=this._getHTML().replace(/\u200B/g,""),Y)for(e=g.length;e--;)q(g[e]);return f&&this._getRangeAndRemoveBookmark(f),d},Pa.setHTML=function(a){var b,c=this._doc.createDocumentFragment(),d=this.createElement("DIV");d.innerHTML=a,c.appendChild(s(d)),Ha(c),La(c),v(c);for(var e=c;e=m(e);)u(e);this._ignoreChange=!0;for(var f=this._body;b=f.lastChild;)f.removeChild(b);f.appendChild(c),u(f),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;var g=this._getRangeAndRemoveBookmark()||this._createRange(f.firstChild,0);return this._recordUndoState(g),this._getRangeAndRemoveBookmark(g),$?this._lastSelection=g:this.setSelection(g),this._updatePath(g,!0),this},Pa.insertElement=function(a,b){if(b||(b=this.getSelection()),b.collapse(!0),h(a))ha(b,a),b.setStartAfter(a);else{for(var c,d,e=this._body,f=oa(b)||e;f!==e&&!f.nextSibling;)f=f.parentNode;f!==e&&(c=f.parentNode,d=w(c,f.nextSibling,e)),d?e.insertBefore(a,d):(e.appendChild(a),d=this.createDefaultBlock(),e.appendChild(d)),b.setStart(d,0),b.setEnd(d,0),ma(b)}return this.focus(),this.setSelection(b),this._updatePath(b),this},Pa.insertImage=function(a,b){var c=this.createElement("IMG",B({src:a},b));return this.insertElement(c),c};var db=/\b((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,}\b)/i,eb=function(a){for(var b,d,e,f,g,h,i,j=a.ownerDocument,k=new c(a,J,function(a){return!n(a,"A")},!1);b=k.nextNode();)for(d=b.data,e=b.parentNode;f=db.exec(d);)g=f.index,h=g+f[0].length,g&&(i=j.createTextNode(d.slice(0,g)),e.insertBefore(i,b)),i=j.createElement("A"),i.textContent=d.slice(g,h),i.href=f[1]?/^(?:ht|f)tps?:/.test(f[1])?f[1]:"http://"+f[1]:"mailto:"+f[2],e.insertBefore(i,b),b.data=d=d.slice(h)};Pa.insertHTML=function(a,b){var c=this.getSelection(),d=this._doc.createDocumentFragment(),e=this.createElement("DIV");e.innerHTML=a,d.appendChild(s(e)),this._recordUndoState(c),this._getRangeAndRemoveBookmark(c);try{var f=d,g={fragment:d,preventDefault:function(){this.defaultPrevented=!0},defaultPrevented:!1};for(eb(d),Ha(d),La(d),Ia(d),d.normalize();f=m(f);)u(f);b&&this.fireEvent("willPaste",g),g.defaultPrevented||(ka(c,g.fragment),_||this._docWasChanged(),c.collapse(!1),this._ensureBottomLine()),this.setSelection(c),this._updatePath(c,!0)}catch(h){this.didError(h)}return this},Pa.insertPlainText=function(a,b){var c,d,e=a.split("\n");for(c=1,d=e.length-1;d>c;c+=1)e[c]="<DIV>"+e[c].split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").replace(/ (?= )/g,"&nbsp;")+"</DIV>";return this.insertHTML(e.join(""),b)};var fb=function(a,b,c){return function(){return this[a](b,c),this.focus()}};Pa.addStyles=function(a){if(a){var b=this._doc.documentElement.firstChild,c=this.createElement("STYLE",{type:"text/css"});c.appendChild(this._doc.createTextNode(a)),b.appendChild(c)}return this},Pa.bold=fb("changeFormat",{tag:"B"}),Pa.italic=fb("changeFormat",{tag:"I"}),Pa.underline=fb("changeFormat",{tag:"U"}),Pa.strikethrough=fb("changeFormat",{tag:"S"}),Pa.subscript=fb("changeFormat",{tag:"SUB"},{tag:"SUP"}),Pa.superscript=fb("changeFormat",{tag:"SUP"},{tag:"SUB"}),Pa.removeBold=fb("changeFormat",null,{tag:"B"}),Pa.removeItalic=fb("changeFormat",null,{tag:"I"}),Pa.removeUnderline=fb("changeFormat",null,{tag:"U"}),Pa.removeStrikethrough=fb("changeFormat",null,{tag:"S"}),Pa.removeSubscript=fb("changeFormat",null,{tag:"SUB"}),Pa.removeSuperscript=fb("changeFormat",null,{tag:"SUP"}),Pa.makeLink=function(a,b){var c=this.getSelection();if(c.collapsed){var d=a.indexOf(":")+1;if(d)for(;"/"===a[d];)d+=1;ha(c,this._doc.createTextNode(a.slice(d)))}return b||(b={}),b.href=a,this.changeFormat({tag:"A",attributes:b},{tag:"A"},c),this.focus()},Pa.removeLink=function(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0),this.focus()},Pa.setFontFace=function(a){return this.changeFormat({tag:"SPAN",attributes:{"class":"font",style:"font-family: "+a+", sans-serif;"}},{tag:"SPAN",attributes:{"class":"font"}}),this.focus()},Pa.setFontSize=function(a){return this.changeFormat({tag:"SPAN",attributes:{"class":"size",style:"font-size: "+("number"==typeof a?a+"px":a)}},{tag:"SPAN",attributes:{"class":"size"}}),this.focus()},Pa.setTextColour=function(a){return this.changeFormat({tag:"SPAN",attributes:{"class":"colour",style:"color: "+a}},{tag:"SPAN",attributes:{"class":"colour"}}),this.focus()},Pa.setHighlightColour=function(a){return this.changeFormat({tag:"SPAN",attributes:{"class":"highlight",style:"background-color: "+a}},{tag:"SPAN",attributes:{"class":"highlight"}}),this.focus()},Pa.setTextAlignment=function(a){return this.forEachBlock(function(b){b.className=(b.className.split(/\s+/).filter(function(a){return!/align/.test(a)}).join(" ")+" align-"+a).trim(),b.style.textAlign=a},!0),this.focus()},Pa.setTextDirection=function(a){return this.forEachBlock(function(b){b.dir=a},!0),this.focus()},Pa.removeAllFormatting=function(a){if(!a&&!(a=this.getSelection())||a.collapsed)return this;for(var b=a.commonAncestorContainer;b&&!i(b);)b=b.parentNode;if(b||(ta(a),b=this._body),b.nodeType===G)return this;this._recordUndoState(a),this._getRangeAndRemoveBookmark(a),na(a,b);for(var c,d,e,f=b.ownerDocument,g=a.startContainer,h=a.startOffset,j=a.endContainer,k=a.endOffset,l=f.createDocumentFragment(),m=f.createDocumentFragment(),n=w(j,k,b),o=w(g,h,b);o!==n;)c=o.nextSibling,l.appendChild(o),o=c;return D(this,l,m),m.normalize(),o=m.firstChild,c=m.lastChild,e=b.childNodes,o?(b.insertBefore(m,n),h=ba.call(e,o),k=ba.call(e,c)+1):(h=ba.call(e,n),k=h),d={startContainer:b,startOffset:h,endContainer:b,endOffset:k},x(b,d),a.setStart(d.startContainer,d.startOffset),a.setEnd(d.endContainer,d.endOffset),ma(a),this.setSelection(a),this._updatePath(a,!0),this.focus()},Pa.increaseQuoteLevel=fb("modifyBlocks",Wa),Pa.decreaseQuoteLevel=fb("modifyBlocks",Xa),Pa.makeUnorderedList=fb("modifyBlocks",$a),Pa.makeOrderedList=fb("modifyBlocks",_a),Pa.removeList=fb("modifyBlocks",ab),Pa.increaseListLevel=fb("modifyBlocks",bb),Pa.decreaseListLevel=fb("modifyBlocks",cb),"object"==typeof exports?module.exports=C:"function"==typeof define&&define.amd?define(function(){return C}):(P.Squire=C,top!==P&&"true"===a.documentElement.getAttribute("data-squireinit")&&(P.editor=new C(a),P.onEditorLoad&&(P.onEditorLoad(P.editor),P.onEditorLoad=null)))}(document);